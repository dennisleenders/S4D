<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ThreeJS Diamond</title>
	<script type="text/javascript" src="libs/three.js"></script>
	<script type="text/javascript" src="libs/stats.js"></script>
	<script type="text/javascript" src="libs/dat.gui.js"></script>
	<script type="text/javascript" src="libs/orbitcontrols.js"></script>
	<script type="text/javascript" src="libs/jquery-1.11.1.js"></script>
	<style>
		body{
			margin: 0;
			padding: 0;dff
			overflow: hidden;
		}
	</style>
</head>	
<body>
	<button onclick="heartbeat()">BEAT</button>
	<div id="stats-output"></div>
	<div id="webgl-output"></div>

<script>

	function init(){
	
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
		var renderer = new THREE.WebGLRenderer({
			scale: 1, antialias: true,
			tonemapping: THREE.FilmicOperator, brightness: 2.5,
		});
		renderer.setClearColor(0x000000, 1.0)
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.shadowMapEnabled = true;


        // ## CAMERA ##//
		camera.position.x = 0;
		camera.position.y = 4.5;
		camera.position.z = 30;
		camera.lookAt(scene.position);
	

		document.getElementById('webgl-output').appendChild(renderer.domElement);

		var step = 0;

		//## ORBITCONTROL ##//
		controls = new THREE.OrbitControls(camera, document, renderer.domElement);
		
		//////////////////////////PYRAMIDE MID//////////////////////////

		//PYRAMIDE-TOP
		var pyramideGeometryTop1 = new THREE.CylinderGeometry(0, 4.8, 8, 4, false); 

		var pyramidMaterialTop1 = new THREE.MeshBasicMaterial({ 
		    vertexColors:THREE.VertexColors, 
		    side:THREE.DoubleSide, 
		    color: 0xFFFFFF,
		    transparent: true,
		    opacity: 1,
		    wireframe: true,
		    wireframeLinewidth: 3
		}); 

		pyramidMeshTop1 = new THREE.Mesh(pyramideGeometryTop1, pyramidMaterialTop1); 
		    pyramidMeshTop1.position.set(0, 4, 0);
		    pyramidMeshTop1.scale.x = 1;
		    pyramidMeshTop1.scale.y = 1;
		    pyramidMeshTop1.scale.z = 1;
		    scene.add(pyramidMeshTop1); 

		//PYRAMIDE-BOTTOM
		var pyramidGeomitryBottom1 = new THREE.CylinderGeometry(0, 4.8, 5, 4, false); 

		var pyramidMaterialBottom1 = new THREE.MeshBasicMaterial({ 
		    vertexColors:THREE.VertexColors, 
		    side:THREE.DoubleSide, 
		    color: 0xFFFFFF,
		    transparent: true,
		    opacity: 1
		}); 

		pyramidMeshBottom1 = new THREE.Mesh(pyramidGeomitryBottom1, pyramidMaterialBottom1); 
		    pyramidMeshBottom1.position.set(0, -2.5, 0);
		    pyramidMeshBottom1.rotation.x=- 1 * Math.PI;
		    scene.add(pyramidMeshBottom1); 

        var sphereGeometry = new THREE.SphereGeometry(1.5,20,20);
        var sphereMaterial = new THREE.MeshBasicMaterial({color: 0xFF0000});
        var sphere = new THREE.Mesh(sphereGeometry,sphereMaterial);

        
        sphere.position.x=0;
        sphere.position.y=0;
        sphere.position.z=0;
        sphere.castShadow=true;

        
        scene.add(sphere);


        //////////////////////////PYRAMIDE RECHTS//////////////////////////

        var pyramideGeometryTop2 = new THREE.CylinderGeometry(0, 4.8, 8, 4, false); 

		var pyramidMaterialTop2 = new THREE.MeshBasicMaterial({ 
		    vertexColors:THREE.VertexColors, 
		    side:THREE.DoubleSide, 
		    color: 0xFFFFFF,
		    transparent: true,
		    opacity: 1,
		    wireframe: true
		}); 

		pyramidMeshTop2 = new THREE.Mesh(pyramideGeometryTop2, pyramidMaterialTop2); 
		    pyramidMeshTop2.position.set(10, 4, 0);
		    scene.add(pyramidMeshTop2); 

		//PYRAMIDE-BOTTOM
		var pyramidGeomitryBottom2 = new THREE.CylinderGeometry(0, 4.8, 5, 4, false); 

		var pyramidMaterialBottom2 = new THREE.MeshBasicMaterial({ 
		    vertexColors:THREE.VertexColors, 
		    side:THREE.DoubleSide, 
		    color: 0xFFFFFF,
		    transparent: true,
		    opacity: 1
		}); 

		pyramidMeshBottom2 = new THREE.Mesh(pyramidGeomitryBottom2, pyramidMaterialBottom2); 
		    pyramidMeshBottom2.position.set(10, -2.5, 0);
		    pyramidMeshBottom2.rotation.x=- 1 * Math.PI;
		    scene.add(pyramidMeshBottom2); 

        var sphereGeometry2 = new THREE.SphereGeometry(1.5,20,20);
        var sphereMaterial2 = new THREE.MeshBasicMaterial({color: 0xFF0000});
        var sphere2 = new THREE.Mesh(sphereGeometry2,sphereMaterial2);

        // position the sphere
        sphere2.position.x=10;
        sphere2.position.y=0;
        sphere2.position.z=0;
        sphere2.castShadow=true;

        // add the sphere to the scene
        scene.add(sphere2);
	
		//////////////////////////PYRAMIDE LINKS//////////////////////////

		//PYRAMIDE-TOP
		var pyramideGeometryTop3 = new THREE.CylinderGeometry(0, 4, 8, 4, false); 

		var pyramidMaterialTop3 = new THREE.MeshBasicMaterial({ 
		    color: 0xFFFFFF,
		    transparent: true,
		    blending: THREE.MultiplyBlending
		}); 

		var pyramidMeshTop3Wireframe = new THREE.MeshBasicMaterial({ 
		    color: 0x000000,
		    wireframe: true,
		    wireframeLinewidth: 1
		}); 

		var pyramidMeshTop3 = new THREE.SceneUtils.createMultiMaterialObject(pyramideGeometryTop3,[pyramidMeshTop3Wireframe,pyramidMeshTop3]); 
		    pyramidMeshTop3.position.set(-10, 4, 0);
		    scene.add(pyramidMeshTop3); 

		//PYRAMIDE-BOTTOM
		var pyramidGeometryBottom3 = new THREE.CylinderGeometry(0, 4, 5, 4, false); 

		var pyramidMaterialBottom3 = new THREE.MeshLambertMaterial({ 
		    color: 0xFFFFFF,
		    opacity: 1,
		});

		var pyramidMaterialBottom3Wireframe = new THREE.MeshLambertMaterial({ 
		    color: 0xFFFFFF,
		    opacity: 1,
			wireframe: true,
			wireframeLinewidth: 1
		});  

		var pyramidMeshBottom3 = new THREE.SceneUtils.createMultiMaterialObject(pyramidGeometryBottom3,[pyramidMaterialBottom3Wireframe,pyramidMeshBottom3]);
		    pyramidMeshBottom3.position.set(-10, -2.5, 0);
		    pyramidMeshBottom3.rotation.x=- 1 * Math.PI;
		    scene.add(pyramidMeshBottom3); 

        var sphereGeometry = new THREE.SphereGeometry(1.5,20,20);
        var sphereMaterial = new THREE.MeshBasicMaterial({
        	color: 0xFF0000
        });
        var sphere3 = new THREE.Mesh(sphereGeometry,sphereMaterial);

        // position the sphere
        sphere3.position.x=-10;
        sphere3.position.y=0;
        sphere3.position.z=0;
        sphere3.castShadow=true;

        // add the sphere to the scene
        scene.add(sphere3);

        var pyramidTopUp = true;
		var pyramidTopDown = false;

		var pyramidBottomUp = true;
		var pyramidBottomDown = false;

		var secondPyramidTopUp = true;
		var secondPyramidTopDown = false;

		var secondPyramidBottomUp = true;
		var secondPyramidBottomDown = false;

		var directionSphereUp = true;
		var directionSphereDown = true;

		var pyramidBeatTopMax = true;
		var pyramidBeatTopMin = false;
		
		var count = 0;

		var beatMax = 0.01;
		var beatMin = 0.002;

		var audio = new Audio('beats.m4a');


		function heartbeat(){
		// 	if(pyramidMeshTop1.scale.x >= 1.15 && pyramidMeshTop1.scale.z >= 1.15 && pyramidBeatTopMax == true){
		//       pyramidBeatTopMax = false;
		//       pyramidBeatTopMin = true;
		//       console.log(count)
		//       count++;
		//     }else if(pyramidMeshTop1.scale.x <= 1.05 && pyramidMeshTop1.scale.z <= 1 && pyramidBeatTopMin == true){
		//       pyramidBeatTopMax = true;
		//       pyramidBeatTopMin = false;
		//     }else if(pyramidMeshTop1.scale.x <= 1.05 && pyramidMeshTop1.scale.z <= 1 && pyramidBeatTopMin == true && count == 2){
		//       pyramidBeatTopMax = true;
		//       pyramidBeatTopMin = false;
		//     }	


		//     if(pyramidBeatTopMax == true && count < 2){

	 //      		pyramidMeshTop1.scale.x += 0.04;
	 //      		pyramidMeshTop1.scale.z += 0.04;	

		//     } else if(pyramidBeatTopMax == true && count == 2){
		//     	count++;
		//     	pyramidMeshTop1.position.x = 0.0001;
	 //      		pyramidMeshTop1.position.z = 0.0001;
	 //      		count++;

	 //      	} else if ( pyramidBeatTopMax == false){	
	 //    		pyramidMeshTop1.scale.x -= 0.01;
	 //    		pyramidMeshTop1.scale.z -= 0.01;
		//     }
		// }

		if(pyramidMeshTop3.scale.x >= 1.15 && pyramidMeshTop3.scale.z >= 1.15 && pyramidBeatTopMax == true){
		      pyramidBeatTopMax = false;
		      pyramidBeatTopMin = true;
		      audio.play()
		    }else if(pyramidMeshTop3.scale.x <= 1.05 && pyramidMeshTop3.scale.z <= 1 && pyramidBeatTopMin == true){
		      pyramidBeatTopMax = true;
		      pyramidBeatTopMin = false;
		    }

		    if(pyramidBeatTopMax == true){
	      	  pyramidMeshTop3.scale.x += beatMax;
	      	  pyramidMeshTop3.scale.z += beatMax;	

	      	} else{	
	    		pyramidMeshTop3.scale.x -= beatMin;
	    		pyramidMeshTop3.scale.z -= beatMin;
		    }
		

		if(pyramidMeshBottom3.scale.x >= 1.15 && pyramidMeshBottom3.scale.z >= 1.15 && pyramidBeatTopMax == true){
		      pyramidBeatTopMax = false;
		      pyramidBeatTopMin = true;
		    }else if(pyramidMeshBottom3.scale.x <= 1.05 && pyramidMeshBottom3.scale.z <= 1 && pyramidBeatTopMin == true){
		      pyramidBeatTopMax = true;
		      pyramidBeatTopMin = false;
		    }

		    if(pyramidBeatTopMax == true){
	      	  pyramidMeshBottom3.scale.x += beatMax;
	      	  pyramidMeshBottom3.scale.z += beatMax;	

	      	} else{	
	    		pyramidMeshBottom3.scale.x -= beatMin;
	    		pyramidMeshBottom3.scale.z -= beatMin;
		    }
		}

	render();

		function render(){

			heartbeat();
			//pyramide 1
            pyramidMeshBottom1.rotation.y += -0.005;
            pyramidMeshTop1.rotation.y += 0.005;

            pyramidMeshTop3.rotation.y += 0.005;
            pyramidMeshBottom3.rotation.y += -0.005;


            //pyramide rechts

		    if(pyramidMeshTop2.position.y >= 9.5 && pyramidTopUp == true){
		      pyramidTopUp = false;
		      pyramidTopDown = true;
		    }else if(pyramidMeshTop2.position.y <= 4 && pyramidTopDown == true){
		      pyramidTopUp = true;
		      pyramidTopDown = false;
		     }	

		    if(pyramidTopUp == true){
	      		pyramidMeshTop2.position.y += 0.05;	
		    }else{
	    		pyramidMeshTop2.position.y -= 0.05;
		    }


		    if(pyramidMeshBottom2.position.y >= 3 && pyramidBottomUp == true){
		      pyramidBottomUp = false;
		      pyramidBottomDown = true;
		    }else if(pyramidMeshBottom2.position.y <= -2.5 && pyramidBottomDown == true){
		      pyramidBottomUp = true;
		      pyramidBottomDown = false;
		     }	

		    if(pyramidBottomUp == true){
	      		pyramidMeshBottom2.position.y += 0.05;
		    }else{
		    	pyramidMeshBottom2.position.y -= 0.05;
		    }


		    if(sphere2.position.y >= 5.5 && directionSphereUp == true){
		      directionSphereUp = false;
		      directionSphereDown = true;
		    }else if(sphere2.position.y <= 0 && directionSphereDown == true){
		      directionSphereUp = true;
		      directionSphereDown = false;
		     }	

		    if(directionSphereUp == true){
	      		sphere2.position.y += 0.05;
		    }else{
		    	sphere2.position.y -= 0.05;
		    }


		    //pyramide links

		    if(pyramidMeshTop3.position.y >= 4.5 && secondPyramidTopUp == true){
		      secondPyramidTopUp = false;
		      secondPyramidTopDown = true;
		    }else if(pyramidMeshTop3.position.y <= 4 && secondPyramidTopDown == true){
		      secondPyramidTopUp = true;
		      secondPyramidTopDown = false;
		     }	

		    if(secondPyramidTopUp == true){
	      		pyramidMeshTop3.position.y += 0.0025;

		    }else{
	    		pyramidMeshTop3.position.y -= 0.0025;
		    }

		    if(pyramidMeshBottom3.position.y >= -2.5 && secondPyramidBottomUp == true){
		      secondPyramidBottomUp = false;
		      secondPyramidBottomDown = true;
		    }else if(pyramidMeshBottom3.position.y <= -3.5 && secondPyramidBottomDown == true){
		      secondPyramidBottomUp = true;
		      secondPyramidBottomDown = false;
		     }	

		    if(secondPyramidBottomUp == true){
	      		pyramidMeshBottom3.position.y += 0.005;
		    }else{
		    	pyramidMeshBottom3.position.y -= 0.005;
		    }


			requestAnimationFrame(render);
			renderer.render(scene, camera);
		}
	};

	window.onload = init

</script>

</body>
</html>